# 営業日報システム テスト仕様書

## 1. テスト概要

### 1.1 目的

本ドキュメントは、営業日報システムの品質を保証するためのテスト仕様を定義します。

### 1.2 対象範囲

- フロントエンド（UI/UX）
- バックエンドAPI
- データベース
- 認証・認可
- セキュリティ

### 1.3 テスト方針

- テスト駆動開発（TDD）を推奨
- カバレッジ目標: 80%以上
- すべての主要機能について正常系・異常系をテスト
- 境界値テストの実施
- セキュリティテストの実施

---

## 2. テストの種類

### 2.1 単体テスト（Unit Test）

- 対象: 個別の関数、メソッド、コンポーネント
- ツール: Jest, React Testing Library, Vitest等
- カバレッジ目標: 85%以上

### 2.2 結合テスト（Integration Test）

- 対象: API、データベース連携
- ツール: Jest, Supertest等
- 実施範囲: 全APIエンドポイント

### 2.3 E2Eテスト（End-to-End Test）

- 対象: ユーザーシナリオ全体
- ツール: Playwright, Cypress等
- 実施範囲: 主要ユースケース

### 2.4 セキュリティテスト

- 対象: 認証・認可、入力検証、XSS、SQL Injection等
- 実施方法: 手動テスト、自動スキャン

### 2.5 パフォーマンステスト

- 対象: レスポンスタイム、負荷テスト
- ツール: Lighthouse, k6等

---

## 3. テスト環境

### 3.1 環境構成

| 環境             | 用途                   | URL                         |
| ---------------- | ---------------------- | --------------------------- |
| 開発環境         | 開発者のローカル環境   | http://localhost:3000       |
| テスト環境       | 自動テスト・手動テスト | https://test.example.com    |
| ステージング環境 | 本番前の最終確認       | https://staging.example.com |
| 本番環境         | 実運用環境             | https://app.example.com     |

### 3.2 テストデータ

#### ユーザーデータ

```json
{
  "営業ユーザー": {
    "email": "sales@test.com",
    "password": "Test1234!",
    "name": "テスト営業",
    "role": "sales"
  },
  "上長ユーザー": {
    "email": "manager@test.com",
    "password": "Test1234!",
    "name": "テスト上長",
    "role": "manager"
  }
}
```

#### 顧客データ

- テスト顧客A: 株式会社テストA
- テスト顧客B: 株式会社テストB
- テスト顧客C: XYZテスト株式会社

---

## 4. 機能別テストケース

### 4.1 認証機能

#### TC-AUTH-001: ログイン成功

| 項目           | 内容                                                                                                                            |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-AUTH-001                                                                                                                     |
| テスト項目     | 正しい認証情報でログイン成功                                                                                                    |
| 優先度         | 高                                                                                                                              |
| 前提条件       | ユーザーがデータベースに登録済み                                                                                                |
| テスト手順     | 1. ログイン画面を表示<br>2. メールアドレス: sales@test.com 入力<br>3. パスワード: Test1234! 入力<br>4. ログインボタンをクリック |
| 期待結果       | - ダッシュボードに遷移<br>- JWTトークンが発行される<br>- ヘッダーにユーザー名が表示される                                       |

#### TC-AUTH-002: ログイン失敗（パスワード誤り）

| 項目           | 内容                                                                                                                                |
| -------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-AUTH-002                                                                                                                         |
| テスト項目     | 誤ったパスワードでログイン失敗                                                                                                      |
| 優先度         | 高                                                                                                                                  |
| 前提条件       | ユーザーがデータベースに登録済み                                                                                                    |
| テスト手順     | 1. ログイン画面を表示<br>2. メールアドレス: sales@test.com 入力<br>3. パスワード: WrongPassword 入力<br>4. ログインボタンをクリック |
| 期待結果       | - エラーメッセージ「メールアドレスまたはパスワードが正しくありません」が表示<br>- ログイン画面に留まる<br>- トークンは発行されない  |

#### TC-AUTH-003: ログイン失敗（存在しないユーザー）

| 項目           | 内容                                                                                                                               |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-AUTH-003                                                                                                                        |
| テスト項目     | 存在しないユーザーでログイン失敗                                                                                                   |
| 優先度         | 高                                                                                                                                 |
| 前提条件       | なし                                                                                                                               |
| テスト手順     | 1. ログイン画面を表示<br>2. メールアドレス: notexist@test.com 入力<br>3. パスワード: Test1234! 入力<br>4. ログインボタンをクリック |
| 期待結果       | - エラーメッセージ「メールアドレスまたはパスワードが正しくありません」が表示<br>- ログイン画面に留まる                             |

#### TC-AUTH-004: ログアウト

| 項目           | 内容                                                                                     |
| -------------- | ---------------------------------------------------------------------------------------- |
| テストケースID | TC-AUTH-004                                                                              |
| テスト項目     | ログアウト機能                                                                           |
| 優先度         | 高                                                                                       |
| 前提条件       | ユーザーがログイン済み                                                                   |
| テスト手順     | 1. ダッシュボードを表示<br>2. ヘッダーのユーザー名をクリック<br>3. ログアウトをクリック  |
| 期待結果       | - ログイン画面に遷移<br>- トークンが無効化される<br>- 保護されたページにアクセスできない |

#### TC-AUTH-005: 未認証アクセス制御

| 項目           | 内容                                                           |
| -------------- | -------------------------------------------------------------- |
| テストケースID | TC-AUTH-005                                                    |
| テスト項目     | 未認証ユーザーの保護ページアクセス                             |
| 優先度         | 高                                                             |
| 前提条件       | ユーザーが未ログイン                                           |
| テスト手順     | 1. ログインせずに /reports にアクセス                          |
| 期待結果       | - ログイン画面にリダイレクト<br>- API呼び出しは401エラーを返す |

---

### 4.2 日報作成機能

#### TC-REPORT-001: 日報作成成功（基本）

| 項目           | 内容                                                                                                                                                                                                                                                                      |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-001                                                                                                                                                                                                                                                             |
| テスト項目     | 正常な日報作成                                                                                                                                                                                                                                                            |
| 優先度         | 高                                                                                                                                                                                                                                                                        |
| 前提条件       | - 営業ユーザーでログイン済み<br>- 顧客データが存在                                                                                                                                                                                                                        |
| テスト手順     | 1. 日報作成画面を表示<br>2. 日付: 今日 を選択<br>3. 訪問記録1を追加:<br>　- 顧客: テスト顧客A<br>　- 訪問内容: 商品提案<br>　- 訪問時刻: 14:00<br>　- 訪問時間: 60分<br>4. 課題・相談: テスト課題 を入力<br>5. 明日やること: テスト予定 を入力<br>6. 提出ボタンをクリック |
| 期待結果       | - 日報が作成される<br>- 日報詳細画面に遷移<br>- 入力した内容が正しく表示される<br>- 成功メッセージが表示                                                                                                                                                                  |

#### TC-REPORT-002: 日報作成成功（複数訪問記録）

| 項目           | 内容                                                                                                                                                                                                                |
| -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-002                                                                                                                                                                                                       |
| テスト項目     | 複数訪問記録を含む日報作成                                                                                                                                                                                          |
| 優先度         | 高                                                                                                                                                                                                                  |
| 前提条件       | - 営業ユーザーでログイン済み<br>- 複数の顧客データが存在                                                                                                                                                            |
| テスト手順     | 1. 日報作成画面を表示<br>2. 訪問記録1を追加（顧客A）<br>3. 「訪問記録を追加」をクリック<br>4. 訪問記録2を追加（顧客B）<br>5. 「訪問記録を追加」をクリック<br>6. 訪問記録3を追加（顧客C）<br>7. 提出ボタンをクリック |
| 期待結果       | - 3件の訪問記録を含む日報が作成される<br>- すべての訪問記録が詳細画面に表示される                                                                                                                                   |

#### TC-REPORT-003: 日報作成失敗（訪問記録なし）

| 項目           | 内容                                                                                                              |
| -------------- | ----------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-003                                                                                                     |
| テスト項目     | 訪問記録なしでの日報作成失敗                                                                                      |
| 優先度         | 高                                                                                                                |
| 前提条件       | 営業ユーザーでログイン済み                                                                                        |
| テスト手順     | 1. 日報作成画面を表示<br>2. 訪問記録を追加せず<br>3. 課題・相談のみ入力<br>4. 提出ボタンをクリック                |
| 期待結果       | - エラーメッセージ「訪問記録を少なくとも1件追加してください」が表示<br>- 日報は作成されない<br>- 作成画面に留まる |

#### TC-REPORT-004: 日報作成失敗（必須項目未入力）

| 項目           | 内容                                                                                                               |
| -------------- | ------------------------------------------------------------------------------------------------------------------ |
| テストケースID | TC-REPORT-004                                                                                                      |
| テスト項目     | 訪問内容未入力での作成失敗                                                                                         |
| 優先度         | 高                                                                                                                 |
| 前提条件       | 営業ユーザーでログイン済み                                                                                         |
| テスト手順     | 1. 日報作成画面を表示<br>2. 顧客のみ選択<br>3. 訪問内容を入力せず<br>4. 提出ボタンをクリック                       |
| 期待結果       | - エラーメッセージ「訪問内容を入力してください」が表示<br>- 該当フィールドが強調表示される<br>- 日報は作成されない |

#### TC-REPORT-005: 日報作成失敗（重複日付）

| 項目           | 内容                                                                                                           |
| -------------- | -------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-005                                                                                                  |
| テスト項目     | 同じ日付の日報を重複作成できない                                                                               |
| 優先度         | 高                                                                                                             |
| 前提条件       | - 営業ユーザーでログイン済み<br>- 今日の日付の日報が既に存在                                                   |
| テスト手順     | 1. 日報作成画面を表示<br>2. 日付: 今日（既存日報と同じ）を選択<br>3. 訪問記録を入力<br>4. 提出ボタンをクリック |
| 期待結果       | - エラーメッセージ「この日付の日報は既に登録されています」が表示<br>- 日報は作成されない                       |

#### TC-REPORT-006: 訪問記録の追加・削除

| 項目           | 内容                                                                                                                                                                  |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-006                                                                                                                                                         |
| テスト項目     | 訪問記録の動的な追加・削除                                                                                                                                            |
| 優先度         | 中                                                                                                                                                                    |
| 前提条件       | 営業ユーザーでログイン済み                                                                                                                                            |
| テスト手順     | 1. 日報作成画面を表示<br>2. 「訪問記録を追加」を3回クリック<br>3. 2番目の訪問記録の削除ボタン（×）をクリック<br>4. 残り2件の訪問記録を入力<br>5. 提出ボタンをクリック |
| 期待結果       | - 訪問記録が正しく追加・削除される<br>- 2件の訪問記録を含む日報が作成される                                                                                           |

#### TC-REPORT-007: 下書き保存

| 項目           | 内容                                                                                                   |
| -------------- | ------------------------------------------------------------------------------------------------------ |
| テストケースID | TC-REPORT-007                                                                                          |
| テスト項目     | 日報の下書き保存                                                                                       |
| 優先度         | 中                                                                                                     |
| 前提条件       | 営業ユーザーでログイン済み                                                                             |
| テスト手順     | 1. 日報作成画面を表示<br>2. 課題・相談のみ入力<br>3. 訪問記録は未入力<br>4. 下書き保存ボタンをクリック |
| 期待結果       | - バリデーションなしで保存される<br>- ダッシュボードに遷移<br>- 後で編集可能                           |

---

### 4.3 日報編集機能

#### TC-REPORT-008: 日報編集成功

| 項目           | 内容                                                                                                                       |
| -------------- | -------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-008                                                                                                              |
| テスト項目     | 自分の日報を編集                                                                                                           |
| 優先度         | 高                                                                                                                         |
| 前提条件       | - 営業ユーザーでログイン済み<br>- 自分の日報が存在                                                                         |
| テスト手順     | 1. 日報詳細画面を表示<br>2. 編集ボタンをクリック<br>3. 課題・相談を変更<br>4. 訪問記録を1件追加<br>5. 更新ボタンをクリック |
| 期待結果       | - 日報が更新される<br>- 変更内容が詳細画面に反映される<br>- updated_atが更新される                                         |

#### TC-REPORT-009: 日報編集失敗（権限なし）

| 項目           | 内容                                                                                                                     |
| -------------- | ------------------------------------------------------------------------------------------------------------------------ |
| テストケースID | TC-REPORT-009                                                                                                            |
| テスト項目     | 他人の日報を編集できない                                                                                                 |
| 優先度         | 高                                                                                                                       |
| 前提条件       | - 営業ユーザーAでログイン済み<br>- 営業ユーザーBの日報が存在                                                             |
| テスト手順     | 1. ユーザーBの日報詳細画面をURLで直接アクセス<br>2. 編集ボタンは表示されないことを確認<br>3. 編集画面のURLに直接アクセス |
| 期待結果       | - 編集ボタンが表示されない<br>- URLで直接アクセスすると403エラー<br>- 「権限がありません」メッセージが表示               |

#### TC-REPORT-010: 日報削除成功

| 項目           | 内容                                                                                                   |
| -------------- | ------------------------------------------------------------------------------------------------------ |
| テストケースID | TC-REPORT-010                                                                                          |
| テスト項目     | 自分の日報を削除                                                                                       |
| 優先度         | 高                                                                                                     |
| 前提条件       | - 営業ユーザーでログイン済み<br>- 自分の日報が存在                                                     |
| テスト手順     | 1. 日報詳細画面を表示<br>2. 削除ボタンをクリック<br>3. 確認ダイアログで「削除」を選択                  |
| 期待結果       | - 確認ダイアログが表示される<br>- 日報が削除される<br>- ダッシュボードに遷移<br>- 成功メッセージが表示 |

#### TC-REPORT-011: 日報削除キャンセル

| 項目           | 内容                                                                                        |
| -------------- | ------------------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-011                                                                               |
| テスト項目     | 日報削除のキャンセル                                                                        |
| 優先度         | 中                                                                                          |
| 前提条件       | - 営業ユーザーでログイン済み<br>- 自分の日報が存在                                          |
| テスト手順     | 1. 日報詳細画面を表示<br>2. 削除ボタンをクリック<br>3. 確認ダイアログで「キャンセル」を選択 |
| 期待結果       | - 日報は削除されない<br>- 詳細画面に留まる                                                  |

---

### 4.4 日報一覧・検索機能

#### TC-REPORT-012: 日報一覧表示（営業）

| 項目           | 内容                                                                                                               |
| -------------- | ------------------------------------------------------------------------------------------------------------------ |
| テストケースID | TC-REPORT-012                                                                                                      |
| テスト項目     | 営業ユーザーが自分の日報一覧を表示                                                                                 |
| 優先度         | 高                                                                                                                 |
| 前提条件       | - 営業ユーザーでログイン済み<br>- 複数の日報が存在                                                                 |
| テスト手順     | 1. 日報一覧画面を表示                                                                                              |
| 期待結果       | - 自分の日報のみ表示される<br>- 他人の日報は表示されない<br>- 日付降順で表示される<br>- ページネーションが機能する |

#### TC-REPORT-013: 日報一覧表示（上長）

| 項目           | 内容                                                                             |
| -------------- | -------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-013                                                                    |
| テスト項目     | 上長が全メンバーの日報一覧を表示                                                 |
| 優先度         | 高                                                                               |
| 前提条件       | - 上長ユーザーでログイン済み<br>- 複数メンバーの日報が存在                       |
| テスト手順     | 1. 日報一覧画面を表示                                                            |
| 期待結果       | - 全メンバーの日報が表示される<br>- 営業名が表示される<br>- 営業名でフィルタ可能 |

#### TC-REPORT-014: 日報検索（期間指定）

| 項目           | 内容                                                                                         |
| -------------- | -------------------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-014                                                                                |
| テスト項目     | 期間を指定して日報を検索                                                                     |
| 優先度         | 高                                                                                           |
| 前提条件       | - ユーザーがログイン済み<br>- 複数月の日報が存在                                             |
| テスト手順     | 1. 日報一覧画面を表示<br>2. 期間: 2025-12-01 〜 2025-12-15 を入力<br>3. 検索ボタンをクリック |
| 期待結果       | - 指定期間内の日報のみ表示される<br>- 期間外の日報は表示されない                             |

#### TC-REPORT-015: 日報検索（顧客指定）

| 項目           | 内容                                                                            |
| -------------- | ------------------------------------------------------------------------------- |
| テストケースID | TC-REPORT-015                                                                   |
| テスト項目     | 顧客を指定して日報を検索                                                        |
| 優先度         | 中                                                                              |
| 前提条件       | - ユーザーがログイン済み<br>- 特定顧客への訪問記録を含む日報が存在              |
| テスト手順     | 1. 日報一覧画面を表示<br>2. 顧客: テスト顧客A を選択<br>3. 検索ボタンをクリック |
| 期待結果       | - テスト顧客Aへの訪問記録を含む日報のみ表示される                               |

#### TC-REPORT-016: ページネーション

| 項目           | 内容                                                                                             |
| -------------- | ------------------------------------------------------------------------------------------------ |
| テストケースID | TC-REPORT-016                                                                                    |
| テスト項目     | ページネーション機能                                                                             |
| 優先度         | 中                                                                                               |
| 前提条件       | - ユーザーがログイン済み<br>- 20件以上の日報が存在                                               |
| テスト手順     | 1. 日報一覧画面を表示（1ページ目）<br>2. 「次へ」ボタンをクリック<br>3. 「前へ」ボタンをクリック |
| 期待結果       | - 1ページに20件表示される<br>- ページ遷移が正しく動作<br>- 現在のページ番号が表示される          |

---

### 4.5 コメント機能

#### TC-COMMENT-001: コメント追加成功

| 項目           | 内容                                                                                                                       |
| -------------- | -------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-COMMENT-001                                                                                                             |
| テスト項目     | 上長がProblemにコメント追加                                                                                                |
| 優先度         | 高                                                                                                                         |
| 前提条件       | - 上長ユーザーでログイン済み<br>- 営業の日報が存在                                                                         |
| テスト手順     | 1. 日報詳細画面を表示<br>2. Problemセクションのコメント入力欄に「アドバイス内容」を入力<br>3. コメント送信ボタンをクリック |
| 期待結果       | - コメントが追加される<br>- コメント一覧に表示される<br>- 投稿者名・日時が表示される<br>- 画面が再表示される               |

#### TC-COMMENT-002: コメント追加失敗（権限なし）

| 項目           | 内容                                                                           |
| -------------- | ------------------------------------------------------------------------------ |
| テストケースID | TC-COMMENT-002                                                                 |
| テスト項目     | 営業ユーザーはコメント追加できない                                             |
| 優先度         | 高                                                                             |
| 前提条件       | 営業ユーザーでログイン済み                                                     |
| テスト手順     | 1. 日報詳細画面を表示                                                          |
| 期待結果       | - コメント入力フォームが表示されない<br>- APIでコメント追加を試みると403エラー |

#### TC-COMMENT-003: コメント更新

| 項目           | 内容                                                                                                                 |
| -------------- | -------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-COMMENT-003                                                                                                       |
| テスト項目     | 自分のコメントを編集                                                                                                 |
| 優先度         | 中                                                                                                                   |
| 前提条件       | - 上長ユーザーでログイン済み<br>- 自分のコメントが存在                                                               |
| テスト手順     | 1. 日報詳細画面を表示<br>2. 自分のコメントの編集ボタンをクリック<br>3. コメント内容を変更<br>4. 更新ボタンをクリック |
| 期待結果       | - コメントが更新される<br>- 更新日時が表示される                                                                     |

#### TC-COMMENT-004: コメント削除

| 項目           | 内容                                                                                              |
| -------------- | ------------------------------------------------------------------------------------------------- |
| テストケースID | TC-COMMENT-004                                                                                    |
| テスト項目     | 自分のコメントを削除                                                                              |
| 優先度         | 中                                                                                                |
| 前提条件       | - 上長ユーザーでログイン済み<br>- 自分のコメントが存在                                            |
| テスト手順     | 1. 日報詳細画面を表示<br>2. 自分のコメントの削除ボタンをクリック<br>3. 確認ダイアログで削除を選択 |
| 期待結果       | - コメントが削除される<br>- コメント一覧から消える                                                |

#### TC-COMMENT-005: コメントバリデーション

| 項目           | 内容                                                                                    |
| -------------- | --------------------------------------------------------------------------------------- |
| テストケースID | TC-COMMENT-005                                                                          |
| テスト項目     | 空のコメントは送信できない                                                              |
| 優先度         | 中                                                                                      |
| 前提条件       | 上長ユーザーでログイン済み                                                              |
| テスト手順     | 1. 日報詳細画面を表示<br>2. コメント入力欄を空のまま<br>3. コメント送信ボタンをクリック |
| 期待結果       | - エラーメッセージ「コメントを入力してください」が表示<br>- コメントは送信されない      |

---

### 4.6 顧客管理機能

#### TC-CUSTOMER-001: 顧客登録成功

| 項目           | 内容                                                                                                                                                                                                                                                      |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-CUSTOMER-001                                                                                                                                                                                                                                           |
| テスト項目     | 新規顧客を登録                                                                                                                                                                                                                                            |
| 優先度         | 高                                                                                                                                                                                                                                                        |
| 前提条件       | ユーザーがログイン済み                                                                                                                                                                                                                                    |
| テスト手順     | 1. 顧客一覧画面を表示<br>2. 新規登録ボタンをクリック<br>3. 必須項目を入力:<br>　- 会社名: テスト株式会社<br>　- 顧客名: テスト太郎<br>4. 任意項目を入力:<br>　- 電話番号: 03-1234-5678<br>　- メールアドレス: test@example.com<br>5. 登録ボタンをクリック |
| 期待結果       | - 顧客が登録される<br>- 顧客一覧画面に遷移<br>- 登録した顧客が一覧に表示される                                                                                                                                                                            |

#### TC-CUSTOMER-002: 顧客登録失敗（必須項目未入力）

| 項目           | 内容                                                                                |
| -------------- | ----------------------------------------------------------------------------------- |
| テストケースID | TC-CUSTOMER-002                                                                     |
| テスト項目     | 必須項目未入力での登録失敗                                                          |
| 優先度         | 高                                                                                  |
| 前提条件       | ユーザーがログイン済み                                                              |
| テスト手順     | 1. 顧客登録画面を表示<br>2. 会社名のみ入力、顧客名を空欄<br>3. 登録ボタンをクリック |
| 期待結果       | - エラーメッセージ「顧客名を入力してください」が表示<br>- 顧客は登録されない        |

#### TC-CUSTOMER-003: 顧客検索

| 項目           | 内容                                                                               |
| -------------- | ---------------------------------------------------------------------------------- |
| テストケースID | TC-CUSTOMER-003                                                                    |
| テスト項目     | キーワードで顧客を検索                                                             |
| 優先度         | 高                                                                                 |
| 前提条件       | - ユーザーがログイン済み<br>- 複数の顧客が登録済み                                 |
| テスト手順     | 1. 顧客一覧画面を表示<br>2. キーワード欄に「ABC」を入力<br>3. 検索ボタンをクリック |
| 期待結果       | - 会社名または顧客名に「ABC」を含む顧客のみ表示される                              |

#### TC-CUSTOMER-004: 顧客編集

| 項目           | 内容                                                                                             |
| -------------- | ------------------------------------------------------------------------------------------------ |
| テストケースID | TC-CUSTOMER-004                                                                                  |
| テスト項目     | 既存顧客の情報を編集                                                                             |
| 優先度         | 高                                                                                               |
| 前提条件       | - ユーザーがログイン済み<br>- 顧客が登録済み                                                     |
| テスト手順     | 1. 顧客一覧画面を表示<br>2. 編集ボタンをクリック<br>3. 電話番号を変更<br>4. 更新ボタンをクリック |
| 期待結果       | - 顧客情報が更新される<br>- 変更内容が反映される                                                 |

#### TC-CUSTOMER-005: 顧客削除成功

| 項目           | 内容                                                                              |
| -------------- | --------------------------------------------------------------------------------- |
| テストケースID | TC-CUSTOMER-005                                                                   |
| テスト項目     | 未使用の顧客を削除                                                                |
| 優先度         | 高                                                                                |
| 前提条件       | - ユーザーがログイン済み<br>- 日報で使用されていない顧客が存在                    |
| テスト手順     | 1. 顧客編集画面を表示<br>2. 削除ボタンをクリック<br>3. 確認ダイアログで削除を選択 |
| 期待結果       | - 顧客が削除される<br>- 顧客一覧から消える                                        |

#### TC-CUSTOMER-006: 顧客削除失敗（使用中）

| 項目           | 内容                                                                                                 |
| -------------- | ---------------------------------------------------------------------------------------------------- |
| テストケースID | TC-CUSTOMER-006                                                                                      |
| テスト項目     | 日報で使用中の顧客は削除できない                                                                     |
| 優先度         | 高                                                                                                   |
| 前提条件       | - ユーザーがログイン済み<br>- 日報で使用中の顧客が存在                                               |
| テスト手順     | 1. 顧客編集画面を表示<br>2. 削除ボタンをクリック<br>3. 確認ダイアログで削除を選択                    |
| 期待結果       | - エラーメッセージ「この顧客は日報で使用されているため削除できません」が表示<br>- 顧客は削除されない |

---

### 4.7 ユーザー管理機能

#### TC-USER-001: ユーザー登録成功

| 項目           | 内容                                                                                                                                                                                                                    |
| -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-USER-001                                                                                                                                                                                                             |
| テスト項目     | 上長が新規ユーザーを登録                                                                                                                                                                                                |
| 優先度         | 高                                                                                                                                                                                                                      |
| 前提条件       | 上長ユーザーでログイン済み                                                                                                                                                                                              |
| テスト手順     | 1. ユーザー一覧画面を表示<br>2. 新規登録ボタンをクリック<br>3. 必須項目を入力:<br>　- 氏名: 新規太郎<br>　- メールアドレス: new@example.com<br>　- パスワード: NewPass123!<br>　- 役割: 営業<br>4. 登録ボタンをクリック |
| 期待結果       | - ユーザーが登録される<br>- ユーザー一覧に表示される<br>- パスワードはハッシュ化されて保存                                                                                                                              |

#### TC-USER-002: ユーザー登録失敗（メール重複）

| 項目           | 内容                                                                                                                        |
| -------------- | --------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-USER-002                                                                                                                 |
| テスト項目     | 既存メールアドレスでの登録失敗                                                                                              |
| 優先度         | 高                                                                                                                          |
| 前提条件       | - 上長ユーザーでログイン済み<br>- sales@test.com が既に登録済み                                                             |
| テスト手順     | 1. ユーザー登録画面を表示<br>2. メールアドレス: sales@test.com を入力<br>3. その他必須項目を入力<br>4. 登録ボタンをクリック |
| 期待結果       | - エラーメッセージ「このメールアドレスは既に登録されています」が表示<br>- ユーザーは登録されない                            |

#### TC-USER-003: ユーザー管理権限（営業）

| 項目           | 内容                                                                            |
| -------------- | ------------------------------------------------------------------------------- |
| テストケースID | TC-USER-003                                                                     |
| テスト項目     | 営業ユーザーはユーザー管理にアクセスできない                                    |
| 優先度         | 高                                                                              |
| 前提条件       | 営業ユーザーでログイン済み                                                      |
| テスト手順     | 1. ユーザー一覧画面のURLに直接アクセス                                          |
| 期待結果       | - 403エラーが表示される<br>- ナビゲーションにユーザー管理メニューが表示されない |

#### TC-USER-004: ユーザー編集

| 項目           | 内容                                                                                             |
| -------------- | ------------------------------------------------------------------------------------------------ |
| テストケースID | TC-USER-004                                                                                      |
| テスト項目     | ユーザー情報の編集                                                                               |
| 優先度         | 高                                                                                               |
| 前提条件       | 上長ユーザーでログイン済み                                                                       |
| テスト手順     | 1. ユーザー一覧画面を表示<br>2. 編集ボタンをクリック<br>3. 部署を変更<br>4. 更新ボタンをクリック |
| 期待結果       | - ユーザー情報が更新される<br>- 変更内容が反映される                                             |

#### TC-USER-005: ユーザー削除失敗（日報あり）

| 項目           | 内容                                                                                                       |
| -------------- | ---------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-USER-005                                                                                                |
| テスト項目     | 日報を作成済みのユーザーは削除できない                                                                     |
| 優先度         | 高                                                                                                         |
| 前提条件       | - 上長ユーザーでログイン済み<br>- 削除対象ユーザーが日報を作成済み                                         |
| テスト手順     | 1. ユーザー編集画面を表示<br>2. 削除ボタンをクリック<br>3. 確認ダイアログで削除を選択                      |
| 期待結果       | - エラーメッセージ「このユーザーは日報を作成しているため削除できません」が表示<br>- ユーザーは削除されない |

---

### 4.8 バリデーション

#### TC-VALIDATION-001: 文字数制限（訪問内容）

| 項目           | 内容                                                                          |
| -------------- | ----------------------------------------------------------------------------- |
| テストケースID | TC-VALIDATION-001                                                             |
| テスト項目     | 訪問内容の文字数制限                                                          |
| 優先度         | 中                                                                            |
| 前提条件       | 営業ユーザーでログイン済み                                                    |
| テスト手順     | 1. 日報作成画面を表示<br>2. 訪問内容に1001文字入力<br>3. 提出ボタンをクリック |
| 期待結果       | - エラーメッセージ「訪問内容は1000文字以内で入力してください」が表示          |

#### TC-VALIDATION-002: メール形式

| 項目           | 内容                                                                                                                        |
| -------------- | --------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-VALIDATION-002                                                                                                           |
| テスト項目     | メールアドレスの形式チェック                                                                                                |
| 優先度         | 中                                                                                                                          |
| 前提条件       | なし                                                                                                                        |
| テスト手順     | 1. ログイン画面を表示<br>2. メールアドレス欄に「invalid-email」を入力<br>3. パスワードを入力<br>4. ログインボタンをクリック |
| 期待結果       | - エラーメッセージ「正しいメールアドレスを入力してください」が表示                                                          |

#### TC-VALIDATION-003: 日付範囲

| 項目           | 内容                                                                                                    |
| -------------- | ------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-VALIDATION-003                                                                                       |
| テスト項目     | 日報作成可能な日付範囲                                                                                  |
| 優先度         | 中                                                                                                      |
| 前提条件       | 営業ユーザーでログイン済み                                                                              |
| テスト手順     | 1. 日報作成画面を表示<br>2. 日付に8日以上前の日付を選択<br>3. 訪問記録を入力<br>4. 提出ボタンをクリック |
| 期待結果       | - エラーメッセージ「日報は過去1週間から今日までの日付で作成できます」が表示                             |

---

### 4.9 セキュリティ

#### TC-SECURITY-001: XSS対策

| 項目           | 内容                                                                                                              |
| -------------- | ----------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-SECURITY-001                                                                                                   |
| テスト項目     | XSS攻撃の防止                                                                                                     |
| 優先度         | 高                                                                                                                |
| 前提条件       | 営業ユーザーでログイン済み                                                                                        |
| テスト手順     | 1. 日報作成画面を表示<br>2. 訪問内容に `<script>alert('XSS')</script>` を入力<br>3. 提出<br>4. 日報詳細画面を表示 |
| 期待結果       | - スクリプトは実行されない<br>- テキストとしてエスケープされて表示される                                          |

#### TC-SECURITY-002: SQLインジェクション対策

| 項目           | 内容                                                                                                                                     |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-SECURITY-002                                                                                                                          |
| テスト項目     | SQLインジェクション攻撃の防止                                                                                                            |
| 優先度         | 高                                                                                                                                       |
| 前提条件       | なし                                                                                                                                     |
| テスト手順     | 1. ログイン画面を表示<br>2. メールアドレスに `' OR '1'='1` を入力<br>3. パスワードに `' OR '1'='1` を入力<br>4. ログインボタンをクリック |
| 期待結果       | - ログインできない<br>- エラーメッセージが表示される<br>- データベースが破壊されない                                                     |

#### TC-SECURITY-003: CSRF対策

| 項目           | 内容                                                          |
| -------------- | ------------------------------------------------------------- |
| テストケースID | TC-SECURITY-003                                               |
| テスト項目     | CSRF攻撃の防止                                                |
| 優先度         | 高                                                            |
| 前提条件       | ユーザーがログイン済み                                        |
| テスト手順     | 1. 外部サイトから日報作成APIを直接呼び出し                    |
| 期待結果       | - CSRFトークンがないため403エラー<br>- リクエストが拒否される |

#### TC-SECURITY-004: 認可チェック

| 項目           | 内容                                                                |
| -------------- | ------------------------------------------------------------------- |
| テストケースID | TC-SECURITY-004                                                     |
| テスト項目     | API レベルでの認可チェック                                          |
| 優先度         | 高                                                                  |
| 前提条件       | 営業ユーザーでログイン済み                                          |
| テスト手順     | 1. ブラウザの開発者ツールを開く<br>2. ユーザー管理APIを直接呼び出し |
| 期待結果       | - 403 Forbiddenエラーが返される<br>- アクセスが拒否される           |

#### TC-SECURITY-005: パスワード強度

| 項目           | 内容                                                                                                      |
| -------------- | --------------------------------------------------------------------------------------------------------- |
| テストケースID | TC-SECURITY-005                                                                                           |
| テスト項目     | パスワード強度の検証                                                                                      |
| 優先度         | 中                                                                                                        |
| 前提条件       | 上長ユーザーでログイン済み                                                                                |
| テスト手順     | 1. ユーザー登録画面を表示<br>2. パスワードに「123456」（弱いパスワード）を入力<br>3. 登録ボタンをクリック |
| 期待結果       | - エラーメッセージ「パスワードは8文字以上で英数字記号を含む必要があります」が表示                         |

---

### 4.10 パフォーマンス

#### TC-PERFORMANCE-001: ページ表示速度

| 項目           | 内容                                                             |
| -------------- | ---------------------------------------------------------------- |
| テストケースID | TC-PERFORMANCE-001                                               |
| テスト項目     | ページ表示時間が2秒以内                                          |
| 優先度         | 中                                                               |
| 前提条件       | ユーザーがログイン済み                                           |
| テスト手順     | 1. ダッシュボードを表示<br>2. Network パネルで読み込み時間を計測 |
| 期待結果       | - 初期表示が2秒以内<br>- First Contentful Paint < 1.5秒          |

#### TC-PERFORMANCE-002: API レスポンス時間

| 項目           | 内容                                                |
| -------------- | --------------------------------------------------- |
| テストケースID | TC-PERFORMANCE-002                                  |
| テスト項目     | API レスポンス時間                                  |
| 優先度         | 中                                                  |
| 前提条件       | なし                                                |
| テスト手順     | 1. 日報一覧APIを呼び出し<br>2. レスポンス時間を計測 |
| 期待結果       | - レスポンス時間が500ms以内（100件のデータ）        |

#### TC-PERFORMANCE-003: 大量データ表示

| 項目           | 内容                                                        |
| -------------- | ----------------------------------------------------------- |
| テストケースID | TC-PERFORMANCE-003                                          |
| テスト項目     | 1000件の日報データの表示                                    |
| 優先度         | 低                                                          |
| 前提条件       | - ユーザーがログイン済み<br>- 1000件以上の日報が存在        |
| テスト手順     | 1. 日報一覧画面を表示<br>2. ページネーション動作を確認      |
| 期待結果       | - ページネーションが正常に機能<br>- 各ページの表示が3秒以内 |

---

### 4.11 レスポンシブ・ブラウザ対応

#### TC-RESPONSIVE-001: スマートフォン表示

| 項目           | 内容                                                                                       |
| -------------- | ------------------------------------------------------------------------------------------ |
| テストケースID | TC-RESPONSIVE-001                                                                          |
| テスト項目     | スマートフォンでの表示                                                                     |
| 優先度         | 中                                                                                         |
| 前提条件       | なし                                                                                       |
| テスト手順     | 1. Chrome DevToolsでiPhone SE画面サイズに変更<br>2. 各画面を表示                           |
| 期待結果       | - レイアウトが崩れない<br>- テーブルがカード形式で表示<br>- タップ可能な要素が十分なサイズ |

#### TC-RESPONSIVE-002: タブレット表示

| 項目           | 内容                                                        |
| -------------- | ----------------------------------------------------------- |
| テストケースID | TC-RESPONSIVE-002                                           |
| テスト項目     | タブレットでの表示                                          |
| 優先度         | 中                                                          |
| 前提条件       | なし                                                        |
| テスト手順     | 1. Chrome DevToolsでiPad画面サイズに変更<br>2. 各画面を表示 |
| 期待結果       | - レイアウトが適切に調整される<br>- 操作がスムーズ          |

#### TC-BROWSER-001: Chrome対応

| 項目           | 内容                              |
| -------------- | --------------------------------- |
| テストケースID | TC-BROWSER-001                    |
| テスト項目     | Google Chromeでの動作             |
| 優先度         | 高                                |
| 前提条件       | なし                              |
| テスト手順     | 1. Chrome最新版で主要機能をテスト |
| 期待結果       | - すべての機能が正常動作          |

#### TC-BROWSER-002: Safari対応

| 項目           | 内容                                               |
| -------------- | -------------------------------------------------- |
| テストケースID | TC-BROWSER-002                                     |
| テスト項目     | Safariでの動作                                     |
| 優先度         | 高                                                 |
| 前提条件       | なし                                               |
| テスト手順     | 1. Safari最新版で主要機能をテスト                  |
| 期待結果       | - すべての機能が正常動作<br>- スタイルの崩れがない |

---

## 5. テスト実施計画

### 5.1 テストフェーズ

| フェーズ             | 実施内容           | 期間       |
| -------------------- | ------------------ | ---------- |
| 単体テスト           | 開発と並行して実施 | 開発期間中 |
| 結合テスト           | API・DB連携テスト  | 3日間      |
| システムテスト       | 全機能の総合テスト | 5日間      |
| 受け入れテスト       | ユーザーによる確認 | 3日間      |
| リグレッションテスト | 修正後の再テスト   | 随時       |

### 5.2 テスト優先度

| 優先度 | 説明                       | 実施タイミング             |
| ------ | -------------------------- | -------------------------- |
| 高     | 主要機能・セキュリティ関連 | 必須実施                   |
| 中     | 重要だが影響範囲が限定的   | 時間があれば実施           |
| 低     | あると良い機能             | スケジュールに余裕があれば |

### 5.3 合格基準

#### 単体テスト

- カバレッジ 85%以上
- すべての優先度「高」のテストケースが成功

#### 結合テスト

- すべてのAPIエンドポイントが正常動作
- データベーストランザクションが正しく機能

#### システムテスト

- すべての優先度「高」「中」のテストケースが成功
- クリティカルなバグ（優先度：高）が0件
- 重要なバグ（優先度：中）が5件以下

#### パフォーマンステスト

- ページ表示速度 < 2秒
- APIレスポンス < 500ms
- Lighthouseスコア > 90

---

## 6. バグ管理

### 6.1 バグ優先度

| 優先度   | 説明                         | 例                           |
| -------- | ---------------------------- | ---------------------------- |
| Critical | システムが動作しない         | ログインできない、データ消失 |
| High     | 主要機能が使えない           | 日報作成ができない           |
| Medium   | 機能に支障があるが回避策あり | 一部の検索が機能しない       |
| Low      | 軽微な不具合                 | 表示の乱れ、誤字             |

### 6.2 バグライフサイクル

1. New（新規）
2. Assigned（担当者割当）
3. In Progress（対応中）
4. Fixed（修正完了）
5. Verified（検証済み）
6. Closed（クローズ）

---

## 7. 自動テスト例

### 7.1 単体テスト例（Jest）

```javascript
// components/ReportForm.test.tsx
import { render, screen, fireEvent } from '@testing-library/react'
import { ReportForm } from './ReportForm'

describe('ReportForm', () => {
  test('訪問記録なしで提出すると エラーメッセージが表示される', () => {
    render(<ReportForm />)

    const submitButton = screen.getByText('提出')
    fireEvent.click(submitButton)

    expect(
      screen.getByText('訪問記録を少なくとも1件追加してください')
    ).toBeInTheDocument()
  })

  test('訪問記録を追加できる', () => {
    render(<ReportForm />)

    const addButton = screen.getByText('訪問記録を追加')
    fireEvent.click(addButton)

    const visitForms = screen.getAllByTestId('visit-record')
    expect(visitForms).toHaveLength(1)
  })
})
```

### 7.2 API テスト例（Supertest）

```javascript
// api/reports.test.ts
import request from 'supertest'
import app from '../app'

describe('POST /api/reports', () => {
  test('正常な日報を作成できる', async () => {
    const token = await getAuthToken('sales@test.com')

    const response = await request(app)
      .post('/api/reports')
      .set('Authorization', `Bearer ${token}`)
      .send({
        report_date: '2025-12-18',
        problem: 'テスト課題',
        plan: 'テスト予定',
        visits: [
          {
            customer_id: 1,
            visit_content: 'テスト訪問内容',
            visit_time: '14:00',
            duration_minutes: 60,
          },
        ],
      })

    expect(response.status).toBe(201)
    expect(response.body.success).toBe(true)
    expect(response.body.data.report_date).toBe('2025-12-18')
  })

  test('訪問記録なしでは作成できない', async () => {
    const token = await getAuthToken('sales@test.com')

    const response = await request(app)
      .post('/api/reports')
      .set('Authorization', `Bearer ${token}`)
      .send({
        report_date: '2025-12-18',
        problem: 'テスト課題',
        visits: [],
      })

    expect(response.status).toBe(422)
    expect(response.body.success).toBe(false)
  })
})
```

### 7.3 E2Eテスト例（Playwright）

```typescript
// e2e/report-creation.spec.ts
import { test, expect } from '@playwright/test'

test('日報作成フロー', async ({ page }) => {
  // ログイン
  await page.goto('/login')
  await page.fill('input[name="email"]', 'sales@test.com')
  await page.fill('input[name="password"]', 'Test1234!')
  await page.click('button[type="submit"]')

  // ダッシュボード確認
  await expect(page).toHaveURL('/')

  // 日報作成
  await page.click('text=日報を作成')
  await page.selectOption('select[name="customer_id"]', '1')
  await page.fill('textarea[name="visit_content"]', 'テスト訪問内容')
  await page.fill('textarea[name="problem"]', 'テスト課題')
  await page.fill('textarea[name="plan"]', 'テスト予定')
  await page.click('button:has-text("提出")')

  // 詳細画面確認
  await expect(page.locator('text=テスト訪問内容')).toBeVisible()
})
```

---

## 8. チェックリスト

### 8.1 リリース前チェックリスト

- [ ] すべての優先度「高」のテストケースが成功
- [ ] セキュリティテストが完了
- [ ] パフォーマンステストが合格基準を満たす
- [ ] 主要ブラウザでの動作確認完了
- [ ] レスポンシブデザインの確認完了
- [ ] データバックアップ手順の確認
- [ ] ロールバック手順の確認
- [ ] 本番環境の設定確認
- [ ] ドキュメントの更新完了
- [ ] ユーザー受け入れテスト完了

---

## 改訂履歴

| バージョン | 日付       | 変更内容 |
| ---------- | ---------- | -------- |
| 1.0.0      | 2025-12-18 | 初版作成 |
